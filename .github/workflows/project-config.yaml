name: Project Configuration
on:
  push:
    branches:
      - 'feature/*'
jobs:
  config:
    name: Prepare configuration
    runs-on: ubuntu-latest  
    outputs:
      config: ${{ steps.extract-config.outputs.configuration }}
      java-version: ${{ fromJson(steps.extract-config.outputs.configuration).java.version }}
      maven-version: ${{ fromJson(steps.extract-config.outputs.configuration).maven.version }}
      deployment: ${{ steps.extract-config.outputs.deployment }}
      deployment-json-object: ${{ toJSON(fromJSON(steps.extract-config.outputs.configuration).deployment) }}
      deployment-namespace: ${{ fromJson(steps.extract-config.outputs.configuration).deployment.namespace }}
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Extract project configuration
        id: extract-config
        run: |
          echo "configuration=$(jq -c '.' '.github/project-config.json')" >> "$GITHUB_OUTPUT"
          echo "deployment=$(jq -c '.deployment' '.github/project-config.json')" >> "$GITHUB_OUTPUT"
  evaluate:
    name: Evaluate configuration
    runs-on: ubuntu-latest
    needs: config
    steps:
      - name: Print configuration
        run: |
          echo ${{ needs.config.outputs.config }}
          echo ${{ needs.config.outputs.java-version }}
          echo ${{ needs.config.outputs.maven-version }}
          echo ${{ needs.config.outputs.deployment }}
          echo ${{ needs.config.outputs.deployment-json-object }}
          echo ${{ needs.config.outputs.deployment-namespace }}